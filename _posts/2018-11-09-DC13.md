---
title: "Interactive Data Visualization with Bokeh"
date: 2018-11-09
tags: [python]
header:
  images:
excerpt: "Interactive Data Visualization with Bokeh"
---

In Bokeh, visual properties of shapes are called glyphs. The visual properties of these glyphs such as position or color can be assigned single values, for example x=10 or fill_color='red'.

## A simple scatter plot
In this example, we're going to make a scatter plot of female literacy vs fertility using data from the [European Environmental Agency](http://www.eea.europa.eu/data-and-maps/figures/correlation-between-fertility-and-female-education). This dataset highlights that countries with low female literacy have high birthrates. The x-axis data has been loaded for you as fertility and the y-axis data has been loaded as female_literacy. Our job is to create a figure, assign x-axis and y-axis labels, and plot female_literacy vs fertility using the circle glyph.

After we have created the figure, in this exercise and the ones to follow, play around with it! Explore the different options available to you on the tab to the right, such as "Pan", "Box Zoom", and "Wheel Zoom". We can click on the question mark sign for more details on any of these tools.

```python
# Import figure from bokeh.plotting
from bokeh.plotting import figure
# Import output_file and show from bokeh.io
from bokeh.io import output_file,show
# Create the figure: p
p = figure(x_axis_label='fertility (children per woman)', y_axis_label='female_literacy (% population)')
# Add a circle glyph to the figure p
p.circle(x=fertility, y=female_literacy)
# Call the output_file() function and specify the name of the file
output_file('fert_lit.html')
# Display the plot
show(p)
```

## A scatter plot with different shapes
By calling multiple glyph functions on the same figure object, we can overlay multiple data sets in the same figure. In this exercise, we will plot female literacy vs fertility for two different regions, Africa and Latin America. Each set of x and y data has been loaded separately for you as fertility_africa, female_literacy_africa, fertility_latinamerica, and female_literacy_latinamerica. Our job is to plot the Latin America data with the circle() glyph, and the Africa data with the x() glyph.

```python
# Create the figure: p
p = figure(x_axis_label='fertility', y_axis_label='female_literacy (% population)')
# Add a circle glyph to the figure p
p.circle(x=fertility_latinamerica,y=female_literacy_latinamerica)
# Add an x glyph to the figure p
p.x(x=fertility_africa,y=female_literacy_africa)
# Specify the name of the file
output_file('fert_lit_separate.html')
# Display the plot
show(p)
```

## Customizing your scatter plots
The three most important arguments to customize scatter glyphs are color, size, and alpha. Bokeh accepts colors as hexadecimal strings, tuples of RGB values between 0 and 255, and any of the 147 [CSS color names](http://www.colors.commutercreative.com/grid/). Size values are supplied in screen space units with 100 meaning the size of the entire figure. The alpha parameter controls transparency. It takes in floating point numbers between 0.0, meaning completely transparent, and 1.0, meaning completely opaque. In this exercise, we'll plot female literacy vs fertility for Africa and Latin America as red and blue circle glyphs, respectively.

```python
# Create the figure: p
p = figure(x_axis_label='fertility (children per woman)', y_axis_label='female_literacy (% population)')
# Add a blue circle glyph to the figure p
p.circle(fertility_latinamerica, female_literacy_latinamerica, color='blue', size=10,alpha=0.8)
# Add a red circle glyph to the figure p
p.circle(fertility_africa,female_literacy_africa,color='red',size=10,alpha=0.8)
# Specify the name of the file
output_file('fert_lit_separate_colors.html')
# Display the plot
show(p)
```

## Lines
We can draw lines on Bokeh plots with the line() glyph function. In this exercise, we'll plot the daily adjusted closing price of Apple Inc.'s stock (AAPL) from 2000 to 2013. The data points are provided for you as lists. date is a list of [datetime objects](https://docs.python.org/3.5/library/datetime.html) to plot on the x-axis and price is a list of prices to plot on the y-axis. Since we are plotting dates on the x-axis, we must add x_axis_type='datetime' when creating the figure object.

```python
# Import figure from bokeh.plotting
from bokeh.plotting import figure
# Create a figure with x_axis_type="datetime": p
p = figure(x_axis_type="datetime",x_axis_label ='Date', y_axis_label='US Dollars')
# Plot date along the x axis and price along the y axis
p.line(date,price,line_width=3)
# Specify the name of the output file and show the result
output_file('line.html')
show(p)
```

## Lines and markers
Lines and markers can be combined by plotting them separately using the same data points. In this exercise, we'll plot a line and circle glyph for the AAPL stock prices. Further, we'll adjust the fill_color keyword argument of the circle() glyph function while leaving the line_color at the default value.

```python
# Import figure from bokeh.plotting
from bokeh.plotting import figure
# Create a figure with x_axis_type='datetime': p
p = figure(x_axis_type='datetime', x_axis_label='Date', y_axis_label='US Dollars')
# Plot date along the x-axis and price along the y-axis
p.line(x=date,y=price)
# With date on the x-axis and price on the y-axis, add a white circle glyph of size 4
p.circle(x=date, y=price, fill_color='white', size=4)
# Specify the name of the output file and show the result
output_file('line.html')
show(p)
```

## Patches
In Bokeh, extended geometrical shapes can be plotted by using the patches() glyph function. The patches glyph takes as input a list-of-lists collection of numeric values specifying the vertices in x and y directions of each distinct patch to plot. In this exercise, we will plot the state borders of Arizona, Colorado, New Mexico and Utah. The latitude and longitude vertices for each state have been prepared as lists. Our job is to plot longitude on the x-axis and latitude on the y-axis. The figure object has been created for you as p.

```python
# Create a list of az_lons, co_lons, nm_lons and ut_lons: x
x = [az_lons, co_lons, nm_lons, ut_lons]
# Create a list of az_lats, co_lats, nm_lats and ut_lats: y
y = [az_lats, co_lats, nm_lats ,ut_lats]
# Add patches to figure p with line_color=white for x and y
p.patches(x,y,line_color='white')
# Specify the name of the output file and show the result
output_file('four_corners.html')
show(p)
```

## Plotting data from NumPy arrays
In the previous exercises, we made plots using data stored in lists. We learned that Bokeh can plot both numbers and datetime objects. In this exercise, we'll generate NumPy arrays using np.linspace() and np.cos() and plot them using the circle glyph.

np.linspace() is a function that returns an array of evenly spaced numbers over a specified interval. For example, np.linspace(0, 10, 5) returns an array of 5 evenly spaced samples calculated over the interval [0, 10]. np.cos(x) calculates the element-wise cosine of some array x.

For more information on NumPy functions, you can refer to the [NumPy User Guide](https://docs.scipy.org/doc/numpy/user/index.html#user) and [NumPy Reference](https://docs.scipy.org/doc/numpy/user/index.html#user).

```python
# Import numpy as np
import numpy as np
# Create array using np.linspace: x
x = np.linspace(0,5,100)
# Create array using np.cos: y
y = np.cos(x)
# Add circles at x and y
p.circle(x,y)
# Specify the name of the output file and show the result
output_file('numpy.html')
show(p)
```

## Plotting data from Pandas DataFrames
We can create Bokeh plots from Pandas DataFrames by passing column selections to the glyph functions. Bokeh can plot floating point numbers, integers, and datetime data types. In this example, we will read a CSV file containing information on 392 automobiles manufactured in the US, Europe and Asia from 1970 to 1982. Our job is to plot miles-per-gallon (mpg) vs horsepower (hp) by passing Pandas column selections into the p.circle() function. Additionally, each glyph will be colored according to values in the color column.

```python
# Import pandas as pd
import pandas as pd
# Read in the CSV file: df
df = pd.read_csv('auto.csv')
# Import figure from bokeh.plotting
from bokeh.plotting import figure
# Create the figure: p
p = figure(x_axis_label='HP', y_axis_label='MPG')
# Plot mpg vs hp by color
p.circle(y=df['mpg'],x=df['hp'],color=df['color'],size=10)
# Specify the name of the output file and show the result
output_file('auto-df.html')
show(p)
```

The ColumnDataSource is a table-like data object that maps string column names to sequences (columns) of data. It is the central and most common data structure in Bokeh.

## The Bokeh ColumnDataSource (continued)
We can create a ColumnDataSource object directly from a Pandas DataFrame by passing the DataFrame to the class initializer. In this exercise, we have imported pandas as pd and read in a data set containing all Olympic medals awarded in the 100 meter sprint from 1896 to 2012. A color column has been added indicating the CSS colorname we wish to use in the plot for every data point. Our job is to import the ColumnDataSource class, create a new ColumnDataSource object from the DataFrame df, and plot circle glyphs with 'Year' on the x-axis and 'Time' on the y-axis. Color each glyph by the color column.

```python
# Import the ColumnDataSource class from bokeh.plotting
from bokeh.plotting import ColumnDataSource
# Create a ColumnDataSource from df: source
source = ColumnDataSource(df)
# Add circle glyphs to the figure p
p.circle(source=source,x='Year',y='Time',size=8,color='color')
# Specify the name of the output file and show the result
output_file('sprint.html')
show(p)
```

## Selection and non-selection glyphs
In this exercise, we're going to add the box_select tool to a figure and change the selected and non-selected circle glyph properties so that selected glyphs are red and non-selected glyphs are transparent blue. We'll use the ColumnDataSource object of the Olympic Sprint dataset you made in the last exercise. It is provided to us with the name source. After we have created the figure, be sure to experiment with the Box Select tool we added!

```python
# Create a figure with the "box_select" tool: p
p = figure(x_axis_label='Year',y_axis_label='Time',tools='box_select')
# Add circle glyphs to the figure p with the selected and non-selected properties
p.circle(x='Year',y='Time',source=source,selection_color='red',nonselection_alpha=0.1)
# Specify the name of the output file and show the result
output_file('selection_glyph.html')
show(p)
```

## Hover glyphs
Now let's practice using and customizing the hover tool. In this exercise, we're going to plot the blood glucose levels for an unknown patient. The blood glucose levels were recorded every 5 minutes on October 7th starting at 3 minutes past midnight. The date and time of each measurement are provided to us as x and the blood glucose levels in mg/dL are provided as y. A bokeh figure is also provided in the workspace as p. Our job is to add a circle glyph that will appear red when the mouse is hovered near the data points. We will also add a customized hover tool object to the plot. When you're done, play around with the hover tool you just created! Notice how the points where your mouse hovers over turn red.


```python
# import the HoverTool
from bokeh.models import HoverTool
# Add circle glyphs to figure p
p.circle(x, y, size=10,
         fill_color='grey', alpha=0.1, line_color=None,
         hover_fill_color='firebrick', hover_alpha=0.5,
         hover_line_color='white')
# Create a HoverTool: hover
hover = HoverTool(tooltips=None,mode='vline')
# Add the hover tool to the figure p
p.add_tools(hover)
# Specify the name of the output file and show the result
output_file('hover_glyph.html')
show(p)
```

## Colormapping
The final glyph customization we'll practice is using the CategoricalColorMapper to color each glyph by a categorical property. Here, we're going to use the automobile dataset to plot miles-per-gallon vs weight and color each circle glyph by the region where the automobile was manufactured. The origin column will be used in the ColorMapper to color automobiles manufactured in the US as blue, Europe as red and Asia as green. The automobile data set is provided to you as a Pandas DataFrame called df. The figure is provided for you as p.

```python
#Import CategoricalColorMapper from bokeh.models
from bokeh.models import CategoricalColorMapper
# Convert df to a ColumnDataSource: source
source = ColumnDataSource(df)
# Make a CategoricalColorMapper object: color_mapper
color_mapper = CategoricalColorMapper(factors=['Europe', 'Asia', 'US'],
                                      palette=['red', 'green', 'blue'])
# Add a circle glyph to the figure p
p.circle(x='weight', y='mpg', source=source,
            color=dict(field='origin', transform=color_mapper),
            legend='origin')
# Specify the name of the output file and show the result
output_file('colormap.html')
show(p)
```

##